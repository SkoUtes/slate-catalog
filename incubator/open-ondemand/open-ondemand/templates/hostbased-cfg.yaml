apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "open-ondemand.fullname" . }}-hostbased-auth
data:
  hostbased.sh: |
    #!/bin/bash
    array=()
    groupmod -g {{ .Values.ssh_keys_GID }} ssh_keys
    for i in `ls /root | grep .pub`; do
      array+=("$i")
    done
    for i in ${array[@]}; do
      cat /root/$i > /etc/ssh/$i
    done
    chmod 0644 /etc/ssh/*.pub
    array=()
    for i in `ls /root/*_key | sed 's/\/root\///g'`; do
      array+=("$i")
    done
    for i in ${array[@]}; do
      cat /root/$i > /etc/ssh/$i
    done
    chmod 0640 /etc/ssh/*_key
    chgrp ssh_keys /etc/ssh/*_key